<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <title>Yu-Gi-Oh Duel</title>
    <style>
        .toast {
            animation: fadeInOut 3s ease forwards;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(50px); }
            10% { opacity: 1; transform: translateX(0); }
            90% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(50px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(99, 102, 241, 0.5); }
            50% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.8); }
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-show {
            display: flex !important;
        }

        .modal-show #modal-content {
            animation: modalFadeIn 0.3s ease forwards;
        }

        .card-defense {
            transform: rotate(90deg);
        }

        .card-hover:hover {
            animation: pulse 0.6s ease-in-out;
        }

        .zone-glow {
            animation: glow 1.5s ease-in-out infinite;
        }

        .card {
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-8px);
            filter: brightness(1.1);
        }

        .dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        body {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div class="min-h-screen w-full p-2 sm:p-4">
        <div class="w-full h-[95vh] grid grid-cols-12 gap-2 sm:gap-3" style="grid-template-rows: minmax(0, 0.5fr) minmax(0, 4fr) minmax(0, 1.5fr);">
            
            <div class="col-span-2 row-span-3 bg-gradient-to-b from-slate-800 to-slate-900 border-2 border-indigo-500/30 rounded-xl shadow-2xl flex flex-col items-center justify-start pt-4 sm:pt-6 gap-2 sm:gap-3">
                <button id="draw-btn" class="bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-bold py-2 px-3 sm:py-3 sm:px-4 rounded-lg shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95 text-xs sm:text-sm w-[90%]">
                    Draw Card
                </button>
                <button id="surrender-btn" class="bg-gradient-to-r from-red-500 to-red-700 hover:from-red-600 hover:to-red-800 text-white font-bold py-2 px-3 sm:py-3 sm:px-4 rounded-lg shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95 text-xs sm:text-sm w-[90%]">
                    Surrender
                </button>
            </div>

            
            <div class="col-span-8 row-span-1 col-start-3 bg-gradient-to-r from-slate-800 to-slate-900 border-2 border-red-500/30 rounded-xl flex flex-row justify-around items-center px-3 sm:px-4 shadow-xl">
                <p id="opp-lp" class="text-red-400 bg-slate-950 rounded-lg px-3 py-1 text-center font-bold text-xs sm:text-sm">8000 LP</p>
                <p id="opp-hand" class="text-slate-300 text-xs sm:text-sm font-semibold">Opponent: 3/6</p>
            </div>

           
            <div class="col-span-2 row-span-3 col-start-11 bg-gradient-to-b from-slate-800 to-slate-900 border-2 border-indigo-500/30 rounded-xl shadow-2xl p-2 sm:p-3">
                <div class="flex flex-col items-center h-full justify-center gap-2 sm:gap-3">
                    <p id="your-lp" class="bg-slate-950 rounded-lg w-full text-emerald-400 p-2 text-center font-bold shadow-lg text-sm sm:text-base">8000 LP</p>
                    <p id="turn-change" class="text-slate-300 font-semibold text-xs sm:text-sm">Your Turn</p>
                    <p id="summon" class="text-amber-400 text-xs sm:text-sm font-medium">Didn't summon</p>
                    <button id="turn-btn" class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-bold py-2 px-3 sm:py-3 sm:px-4 rounded-lg shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95 w-full text-xs sm:text-sm">
                        End Turn
                    </button>
                </div>
            </div>

            
            <div class="col-span-8 row-span-1 col-start-3 row-start-2 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 border-2 border-indigo-500/30 flex flex-col justify-between gap-1 rounded-xl shadow-2xl p-1 sm:p-2">
                
                <div class="h-[48%] w-full grid grid-cols-5 gap-1 sm:gap-2 place-items-center">
                    <div id="oppZone1" class="card_zone border-2 border-dashed border-indigo-400/40 bg-slate-700/30 hover:bg-slate-600/40 relative flex justify-center items-center w-full h-full max-h-full overflow-hidden rounded-lg transition-all duration-300"></div>
                    <div id="oppZone2" class="card_zone border-2 border-dashed border-indigo-400/40 bg-slate-700/30 hover:bg-slate-600/40 relative flex justify-center items-center w-full h-full max-h-full overflow-hidden rounded-lg transition-all duration-300"></div>
                    <div id="oppZone3" class="card_zone border-2 border-dashed border-indigo-400/40 bg-slate-700/30 hover:bg-slate-600/40 relative flex justify-center items-center w-full h-full max-h-full overflow-hidden rounded-lg transition-all duration-300"></div>
                    <div id="oppZone4" class="card_zone border-2 border-dashed border-indigo-400/40 bg-slate-700/30 hover:bg-slate-600/40 relative flex justify-center items-center w-full h-full max-h-full overflow-hidden rounded-lg transition-all duration-300"></div>
                    <div id="oppZone5" class="card_zone border-2 border-dashed border-indigo-400/40 bg-slate-700/30 hover:bg-slate-600/40 relative flex justify-center items-center w-full h-full max-h-full overflow-hidden rounded-lg transition-all duration-300"></div>
                </div>

                
                <div class="h-[48%] w-full grid grid-cols-5 gap-1 sm:gap-2 place-items-center">
                    <div id="zone-1" class="my_card_zone border-2 border-dashed border-emerald-400/40 bg-slate-700/30 hover:bg-slate-600/40 relative flex justify-center items-center w-full h-full max-h-full overflow-hidden rounded-lg transition-all duration-300"></div>
                    <div id="zone-2" class="my_card_zone border-2 border-dashed border-emerald-400/40 bg-slate-700/30 hover:bg-slate-600/40 relative flex justify-center items-center w-full h-full max-h-full overflow-hidden rounded-lg transition-all duration-300"></div>
                    <div id="zone-3" class="my_card_zone border-2 border-dashed border-emerald-400/40 bg-slate-700/30 hover:bg-slate-600/40 relative flex justify-center items-center w-full h-full max-h-full overflow-hidden rounded-lg transition-all duration-300"></div>
                    <div id="zone-4" class="my_card_zone border-2 border-dashed border-emerald-400/40 bg-slate-700/30 hover:bg-slate-600/40 relative flex justify-center items-center w-full h-full max-h-full overflow-hidden rounded-lg transition-all duration-300"></div>
                    <div id="zone-5" class="my_card_zone border-2 border-dashed border-emerald-400/40 bg-slate-700/30 hover:bg-slate-600/40 relative flex justify-center items-center w-full h-full max-h-full overflow-hidden rounded-lg transition-all duration-300"></div>
                </div>
            </div>

            
            <div class="col-span-8 row-span-1 col-start-3 row-start-3 bg-gradient-to-r from-slate-800 to-slate-900 border-2 border-emerald-500/30 rounded-xl shadow-2xl p-2 flex flex-col">
                <p id="hand-count" class="text-xs sm:text-sm text-slate-300 mb-1 font-semibold">Hand (4/6)</p>
                <div id="hand" class="flex-1 flex gap-1 sm:gap-2 justify-center items-center overflow-x-auto overflow-y-hidden"></div>
            </div>
        </div>
    </div>

    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    
    <div id="modal-overlay" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-gradient-to-br from-slate-800 to-slate-900 border-2 border-indigo-500 rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full transform transition-all duration-300 scale-95" id="modal-content">
            
            <h2 id="modal-title" class="text-2xl sm:text-3xl font-bold text-center mb-6 text-white"></h2>
            
            
            <div id="modal-body" class="space-y-4">
                
            </div>
        </div>
    </div>

    <script>
        async function fetchData(dataPath) {
            try{
                const response= await fetch(dataPath)
                if(!response.ok)
                {
                    throw new Error(`Error, status: ${response.status}`)
                }
                const cardsData= await response.json()
                return cardsData;
            }
            catch(error){
                console.error("failed to fetch data: ", error)
                return [];
            }
        }

        function showToast(message, type = "info") {
            const container = document.getElementById("toast-container");

            const colors = {
                info: "bg-indigo-600",
                success: "bg-emerald-600",
                warning: "bg-amber-600",
                error: "bg-red-600"
            };

            const toast = document.createElement("div");
            toast.className = `toast text-white px-4 py-3 rounded-lg shadow-2xl ${colors[type]} border border-white/20`;
            toast.textContent = message;

            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function shuffle(deck){
            let i= deck.length, j;
            while(--i>0)
            {
                j= Math.floor(Math.random()*(i+1));
                [deck[j],deck[i]] = [deck[i],deck[j]]
            }
        }

        let deck=[];
        let oppDeck=[];
        let oppCardsInHand=[]

        const drawBtn = document.getElementById('draw-btn')
        const oppLp= document.getElementById('opp-lp')
        const oppHand= document.getElementById('opp-hand')
        const oppfieldZones= document.querySelectorAll('.card_zone');
        const  handCount= document.getElementById('hand-count')
        const hand=document.getElementById('hand')
        const yourLp= document.getElementById('your-lp')
        const turnChange= document.getElementById('turn-change')
        const summon= document.getElementById('summon')
        const turnBtn= document.getElementById('turn-btn')
        const surrenderBtn = document.getElementById('surrender-btn')
        const modalOverlay = document.getElementById('modal-overlay')
        const modalTitle = document.getElementById('modal-title')
        const modalBody = document.getElementById('modal-body')

        let currentDraggingCard = null;
        let currentDropZone = null;
        let cardPosition = null;

        yourLp.textContent = '8000 LP'; 
        oppLp.textContent = '8000 LP';
        handCount.textContent = 'Hand (4/6)'; 
        oppHand.textContent = 'Opponent: 4/6';

        // Modal Functions
        function showModal(type, data = {}) {
            modalOverlay.classList.add('modal-show');
            
            if (type === 'position') {
                modalTitle.textContent = 'Choose Card Position';
                modalBody.innerHTML = `
                    <div class="flex flex-col gap-4">
                        <button id="attack-btn" class="bg-gradient-to-r from-red-500 to-orange-600 hover:from-red-600 hover:to-orange-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95">
                            Attack Position
                        </button>
                        <button id="defense-btn" class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95">
                            Defense Position
                        </button>
                    </div>
                `;
                
                document.getElementById('attack-btn').addEventListener('click', () => {
                    cardPosition = 'attack';
                    closeModal();
                    completeSummon();
                });
                
                document.getElementById('defense-btn').addEventListener('click', () => {
                    cardPosition = 'defense';
                    closeModal();
                    completeSummon();
                });
            } else if (type === 'gameOver') {
                modalTitle.textContent = data.result === 'win' ? 'ðŸŽ‰ Victory!' : 'ðŸ’” Defeat';
                modalTitle.className = data.result === 'win' 
                    ? 'text-2xl sm:text-3xl font-bold text-center mb-6 text-emerald-400'
                    : 'text-2xl sm:text-3xl font-bold text-center mb-6 text-red-400';
                    
                modalBody.innerHTML = `
                    <p class="text-white text-center mb-6 text-lg">${data.message}</p>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="window.location.href='index.html'" class="bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-4 rounded-lg shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95 text-sm">
                            Home
                        </button>
                        <button onclick="window.location.href='market.html'" class="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-bold py-3 px-4 rounded-lg shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95 text-sm">
                            Market
                        </button>
                        <button onclick="window.location.href='deck.html'" class="bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white font-bold py-3 px-4 rounded-lg shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95 text-sm">
                            Deck
                        </button>
                        <button onclick="window.location.reload()" class="bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white font-bold py-3 px-4 rounded-lg shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95 text-sm">
                            Play Again
                        </button>
                    </div>
                `;
            }
        }

        function closeModal() {
            modalOverlay.classList.remove('modal-show');
        }

        
        surrenderBtn.addEventListener('click', () => {
            showModal('gameOver', {
                result: 'lose',
                message: 'You surrendered the match.'
            });
        });

        function coinToss(){
            const startingPlayer = Math.floor(Math.random() * 2)
            showToast((startingPlayer)? "You are starting" : "Opponent is starting", (startingPlayer)? "success": "warning")
            return startingPlayer? true : false;
        }

        let playerTurn;
        let turnCount= 1;
        let drew= false;
        let summoned= false;

        function updateTurn(){
            turnChange.textContent= playerTurn? "Your Turn" : "Opponent's Turn";
            turnChange.className= playerTurn? "text-emerald-400 font-semibold text-xs sm:text-sm" : "text-red-400 font-semibold text-xs sm:text-sm"

            drawBtn.disabled= !playerTurn;
            drawBtn.classList.toggle("opacity-50", !playerTurn);
            drawBtn.classList.toggle("cursor-not-allowed", !playerTurn);

            turnBtn.disabled= !playerTurn;
            turnBtn.classList.toggle("opacity-50", !playerTurn)
            turnBtn.classList.toggle("cursor-not-allowed", !playerTurn);

            document.querySelectorAll('.card').forEach(card => {
                card.draggable = playerTurn && !summoned;
            });
        }

        turnBtn.addEventListener("click", ()=>{
            if (!drew) {
                showToast("You must draw a card first!", "warning");
                return;
            }
            endTurn();
        })

        function endTurn(){
            playerTurn= !playerTurn;
            if (playerTurn) drew= false;
            summoned= false;
            summon.textContent = "Didn't summon";
            summon.className = "text-amber-400 text-xs sm:text-sm font-medium";

            turnCount++;
            updateTurn()

            if(playerTurn) startPlayerTurn() 
            else startOppTurn() 
        }

        function startPlayerTurn(){
            showToast("Your Turn!", "success")
            updateTurn();
        }

        function startOppTurn(){
            showToast("Opponent's Turn", "warning")
            updateTurn();
            let cardData;
            setTimeout(()=>{

                if(oppCardsInHand.length<6){
                    cardData= oppDeck.pop();
                    showToast("Opponent drew a card", "info")

                    if(!cardData) {
                        showToast("You win! Opponent's deck is empty", "success")
                        return
                    }
                    oppCardsInHand.push(cardData)

                    oppHand.textContent = `Opponent: ${oppCardsInHand.length}/6`

                    cardData= oppCardsInHand.splice(Math.floor(Math.random()*oppCardsInHand.length), 1)[0]
                    let card= renderCard(cardData)

                    const emptyZones = [...oppfieldZones].filter(zone=> !zone.hasChildNodes() );

                    if(emptyZones.length===0) oppCardsInHand.push(card);
                    else {
                        const chosenZone = emptyZones[Math.floor(Math.random()*emptyZones.length)]
                        chosenZone.append(card);
                        summoned=true
                    }
                }
                else showToast("Opponent's hand is full, draw phase skipped", "info")

                setTimeout(() => {
                    endTurn();
                }, 1000);
                
            }, 1000)
        }

        function addDragListeners(card) {
            card.addEventListener("dragstart", (e) => {
                if (!drew) {
                    e.preventDefault();
                    showToast("Draw a card first!", "warning");
                    return;
                }
                if (summoned) {
                    e.preventDefault();
                    showToast("Already summoned this turn!", "warning");
                    return;
                }
                card.classList.add("dragging");
            });

            card.addEventListener("dragend", (e) => {
                card.classList.remove("dragging");
            });
        }

        function addZoneListeners(zone) {
            function handleDragOver(e) {
                if(playerTurn) e.preventDefault(); 
                zone.classList.add("bg-emerald-500/30", "border-emerald-300", "zone-glow");
            }

            function handleDragLeave(e) {
                zone.classList.remove("bg-emerald-500/30", "border-emerald-300", "zone-glow");
            }

            function handleDrop(e) {
                e.preventDefault();

                if (summoned) {
                    showToast("You can only summon 1 monster per turn!", "warning")
                    zone.classList.remove("bg-emerald-500/30", "border-emerald-300", "zone-glow");
                    return;
                }

                const dragged = document.querySelector(".dragging");

                zone.appendChild(dragged);
                dragged.draggable = false;
                zone.classList.remove("bg-emerald-500/30", "border-emerald-300", "zone-glow");

                zone.removeEventListener("dragover", handleDragOver);
                zone.removeEventListener("dragleave", handleDragLeave);
                zone.removeEventListener("drop", handleDrop);

                summon.textContent = "Summoned!";
                summon.className = "text-emerald-400 text-xs sm:text-sm font-bold";
                summoned = true;

                document.querySelectorAll('.card').forEach(card => card.draggable = false);
            }

            zone.addEventListener("dragover", handleDragOver);
            zone.addEventListener("dragleave", handleDragLeave);
            zone.addEventListener("drop", handleDrop);
        }

        window.onload= async function() {
            const deckFilePath='./cardsData.json'
            const oppDeckPath= './cardsData.json'
            deck= await fetchData(deckFilePath)
            oppDeck= await fetchData(oppDeckPath) 
            shuffle(deck);
            shuffle(oppDeck);
            
            for(let i=0; i<4; i++)
            {
                let card_details= deck.pop();
                let card= renderCard(card_details)
                hand.append(card);

                card_details= oppDeck.pop()
                oppCardsInHand.push(card_details)
            }

            playerTurn= coinToss();
            updateTurn();
            updateHandCount();

            if (!playerTurn) {
                startOppTurn();
            }

            if (deck.length === 0) {
                showModal('gameOver', {
                    result: 'lose',
                    message: "Your deck is empty!"
                });
                drawBtn.disabled = true;
                return;
            }

            drawBtn.addEventListener('click',()=>{
                if(playerTurn)
                {
                    if(drew) {
                        showToast("You've already drawn, cannot draw again", "warning")
                        return
                    }

                    if (hand.children.length >= 6) {
                        showToast("Your hand is full (max 6 cards)", "warning")
                        return;
                    }

                    const card_details= deck.pop();

                    if (!card_details) {
                        showModal('gameOver', {
                            result: 'lose',
                            message: "No cards left to draw!"
                        });
                        drawBtn.disabled = true; 
                        return; 
                    }

                    drew= true;
                    const card= renderCard(card_details)
                    hand.append(card);
                    updateHandCount();
                    updateTurn();
                }
            })

            document.querySelectorAll(".my_card_zone").forEach(addZoneListeners);
        }

        function updateHandCount() {
            handCount.textContent = `Hand (${hand.children.length}/6)`;
        }

        let cardInHand= [];
        function renderCard(card)
        {
            cardInHand.push(card)
            const colorLayer= document.createElement('div');
            colorLayer.classList.add('p-0.5', 'sm:p-1', 'flex', 'flex-col', 'items-center', 'shadow-xl', 'rounded-lg', 'h-full', 'w-full');
            
            if(card.cardType=="monster")
            {
                colorLayer.classList.add('bg-gradient-to-br', 'from-orange-400', 'to-orange-600')
            } else if(card.cardType=="effect monster")
            {
                colorLayer.classList.add('bg-gradient-to-br', 'from-orange-500', 'to-orange-700')
            } else if(card.cardType=="fusion")
            {
                colorLayer.classList.add('bg-gradient-to-br', 'from-purple-500', 'to-purple-700')
            } else if(card.cardType=="link")
            {
                colorLayer.classList.add('bg-gradient-to-br', 'from-blue-500', 'to-blue-700')
            } else if(card.cardType=="trap")
            {
                colorLayer.classList.add('bg-gradient-to-br', 'from-pink-500', 'to-pink-700')
            } else if(card.cardType=="spell")
            {
                colorLayer.classList.add('bg-gradient-to-br', 'from-emerald-400', 'to-emerald-600')
            } else if(card.cardType=="synchro")
            {
                colorLayer.classList.add('bg-gradient-to-br', 'from-slate-200', 'to-slate-400')
            }
            
            const nameContainer= document.createElement('div');
            nameContainer.classList.add('w-full', 'mb-0.5', 'flex', 'justify-center', 'items-center', 'text-white');
            const name= document.createElement('p');
            name.classList.add('text-[0.5rem]', 'sm:text-xs', 'font-bold', 'truncate', 'text-center', 'drop-shadow-lg');
            name.textContent= card.name;
            nameContainer.append(name);

            const imageContainer= document.createElement('div');
            imageContainer.className="w-full flex-1 bg-slate-900 rounded overflow-hidden shadow-inner";
            const image= document.createElement('img');
            image.src= card.illustration;
            image.alt= card.name;
            image.className="w-full h-full object-cover";
            imageContainer.append(image);
            
            const detailsContainer= document.createElement('div');
            detailsContainer.className= "w-full p-0.5 sm:p-1 border border-slate-800 rounded shadow-lg text-slate-900 mt-0.5";
            if(card.cardType=="monster" || card.cardType=="effect monster")
            {
                detailsContainer.classList.add('bg-orange-200/90')
            } else if(card.cardType=="fusion")
            {
                detailsContainer.classList.add('bg-purple-200/90')
            } else if(card.cardType=="link")
            {
                detailsContainer.classList.add('bg-blue-200/90')
            } else if(card.cardType=="trap")
            {
                detailsContainer.classList.add('bg-pink-200/90')
            } else if(card.cardType=="spell")
            {
                detailsContainer.classList.add('bg-emerald-100/90')
            }

            const atk_def= document.createElement('p');
            atk_def.className="w-full text-center font-bold text-[0.45rem] sm:text-[0.55rem]"
            atk_def.textContent= card.atk_def;
            detailsContainer.append(atk_def);

            colorLayer.append(nameContainer);
            colorLayer.append(imageContainer);
            colorLayer.append(detailsContainer);

            const gridItem= document.createElement('div');
            gridItem.className = "card flex-shrink-0 h-full w-auto max-w-[120px] aspect-[5/7] flex flex-col transition-transform duration-200 card-hover cursor-grab active:cursor-grabbing";
            gridItem.append(colorLayer)
            gridItem.draggable = true;

            addDragListeners(gridItem);

            return gridItem
        }
    </script>
</body>
</html>